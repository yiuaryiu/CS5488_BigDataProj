<html>
<body>

<code class="prism language-python has-numbering" onclick="mdcp.signin(event)" style="position: unset;">package DBSCAN
<span class="token keyword">import</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>mutable<span class="token punctuation">.</span>ArrayBuffer
<span class="token keyword">import</span> scala<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Source
<span class="token keyword">import</span> scala<span class="token punctuation">.</span>util<span class="token punctuation">.</span>control<span class="token punctuation">.</span>Breaks<span class="token punctuation">.</span>_
<span class="token builtin">object</span> myDBSCAN <span class="token punctuation">{<!-- --></span>

  <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>args<span class="token punctuation">:</span> Array<span class="token punctuation">[</span>String<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Unit <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    val minPts <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">//</span>密度阈值
    val ePs <span class="token operator">=</span> <span class="token number">1.39</span> <span class="token operator">//</span>领域半径
    val dim <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">//</span>数据集维度
    <span class="token operator">//</span>处理输入数据
    val fileName <span class="token operator">=</span> <span class="token string">"D:\\dbscan_data.txt"</span>
    val lines <span class="token operator">=</span> Source<span class="token punctuation">.</span>fromFile<span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">.</span>getLines<span class="token punctuation">(</span><span class="token punctuation">)</span>
    val points <span class="token operator">=</span> lines<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>line <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token operator">//</span>数据预处理
    val parts <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\t"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span>toDouble<span class="token punctuation">)</span>
      var vector <span class="token operator">=</span> Vector<span class="token punctuation">[</span>Double<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span><span class="token operator">-</span> <span class="token number">0</span> to dim <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
        vector <span class="token operator">+</span><span class="token operator">+=</span> Vector<span class="token punctuation">(</span>parts<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
      vector
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toArray
    println<span class="token punctuation">(</span><span class="token string">"数据集点的x坐标如下："</span><span class="token punctuation">)</span>
    points<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>v <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>v<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    println<span class="token punctuation">(</span><span class="token punctuation">)</span>
    println<span class="token punctuation">(</span><span class="token string">"数据集点的y坐标如下："</span><span class="token punctuation">)</span>
    points<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>v <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>v<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    println<span class="token punctuation">(</span><span class="token punctuation">)</span>
    val <span class="token punctuation">(</span>cluster<span class="token punctuation">,</span>types<span class="token punctuation">)</span> <span class="token operator">=</span> runDBSCAN<span class="token punctuation">(</span>points<span class="token punctuation">,</span>ePs<span class="token punctuation">,</span>minPts<span class="token punctuation">)</span>
    printResult<span class="token punctuation">(</span>points<span class="token punctuation">,</span>cluster<span class="token punctuation">,</span>types<span class="token punctuation">)</span>

  <span class="token punctuation">}</span>

  <span class="token keyword">def</span> <span class="token function">runDBSCAN</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span>Array<span class="token punctuation">[</span>Vector<span class="token punctuation">[</span>Double<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>ePs<span class="token punctuation">:</span>Double<span class="token punctuation">,</span>minPts<span class="token punctuation">:</span>Int<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">(</span>Array<span class="token punctuation">[</span>Int<span class="token punctuation">]</span><span class="token punctuation">,</span>Array<span class="token punctuation">[</span>Int<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
      val types <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span><span class="token operator">-</span> <span class="token number">0</span> to data<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">yield</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toArray <span class="token operator">//</span>用于区分核心点<span class="token number">1</span>，边界点<span class="token number">0</span>，和噪音点<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">(</span>即cluster中值为<span class="token number">0</span>的点<span class="token punctuation">)</span>
      val visited <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span><span class="token operator">-</span> <span class="token number">0</span> to data<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">yield</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toArray <span class="token operator">//</span>用于判断该点是否处理过，<span class="token number">0</span>表示未处理过
      var number <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">//</span>用于标记类
      var xTempPoint <span class="token operator">=</span> Vector<span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span>
      var yTempPoint <span class="token operator">=</span> Vector<span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span>
      var distance <span class="token operator">=</span> new Array<span class="token punctuation">[</span><span class="token punctuation">(</span>Double<span class="token punctuation">,</span>Int<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
      var distanceTemp <span class="token operator">=</span> new Array<span class="token punctuation">[</span><span class="token punctuation">(</span>Double<span class="token punctuation">,</span>Int<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
      val neighPoints <span class="token operator">=</span> new ArrayBuffer<span class="token punctuation">[</span>Vector<span class="token punctuation">[</span>Double<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      var neighPointsTemp <span class="token operator">=</span> new Array<span class="token punctuation">[</span>Vector<span class="token punctuation">[</span>Double<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
      val cluster <span class="token operator">=</span> new Array<span class="token punctuation">[</span>Int<span class="token punctuation">]</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">//</span>用于标记每个数据点所属的类别
      var index <span class="token operator">=</span> <span class="token number">0</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span><span class="token operator">-</span> <span class="token number">0</span> to data<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token operator">//</span>对每一个点进行处理
         <span class="token keyword">if</span><span class="token punctuation">(</span>visited<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token operator">//</span>表示该点未被处理
           visited<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">//</span>标记为处理过
           xTempPoint <span class="token operator">=</span> data<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">//</span>取到该点
           distance <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>vectorDis<span class="token punctuation">(</span>x<span class="token punctuation">,</span>xTempPoint<span class="token punctuation">)</span><span class="token punctuation">,</span>data<span class="token punctuation">.</span>indexOf<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">//</span>取得该点到其他所有点的距离Array<span class="token punctuation">{<!-- --></span><span class="token punctuation">(</span>distance<span class="token punctuation">,</span>index<span class="token punctuation">)</span><span class="token punctuation">}</span>
           neighPoints <span class="token operator">+</span><span class="token operator">+=</span> distance<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">&gt;</span> x<span class="token punctuation">.</span>_1 <span class="token operator">&lt;=</span> ePs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>v <span class="token operator">=</span><span class="token operator">&gt;</span> data<span class="token punctuation">(</span>v<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">//</span>找到半径ePs内的所有点<span class="token punctuation">(</span>密度相连点集合<span class="token punctuation">)</span>

           <span class="token keyword">if</span><span class="token punctuation">(</span>neighPoints<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> neighPoints<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> minPts<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
             breakable<span class="token punctuation">{<!-- --></span>
               <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span><span class="token operator">-</span> <span class="token number">0</span> to neighPoints<span class="token punctuation">.</span>length <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token operator">//</span>此为非核心点，若其领域内有核心点，则该点为边界点<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>new<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
                 var index <span class="token operator">=</span> data<span class="token punctuation">.</span>indexOf<span class="token punctuation">(</span>neighPoints<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
                 <span class="token keyword">if</span><span class="token punctuation">(</span>types<span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                   types<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">//</span>边界点<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>new<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
                   <span class="token keyword">break</span>
                 <span class="token punctuation">}</span>
               <span class="token punctuation">}</span>
             <span class="token punctuation">}</span>
           <span class="token punctuation">}</span>
           <span class="token keyword">if</span><span class="token punctuation">(</span>neighPoints<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> minPts<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token operator">//</span>核心点<span class="token punctuation">,</span>此时neighPoints表示以该核心点出发的密度相连点的集合
             types<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span>
             cluster<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=</span> number
             <span class="token keyword">while</span><span class="token punctuation">(</span>neighPoints<span class="token punctuation">.</span>isEmpty <span class="token operator">==</span> false<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token operator">//</span>对该核心点领域内的点迭代寻找核心点，直到所有核心点领域半径内的点组成的集合不再扩大（每次聚类 ）
               yTempPoint <span class="token operator">=</span>neighPoints<span class="token punctuation">.</span>head <span class="token operator">//</span>取集合中第一个点
               index <span class="token operator">=</span> data<span class="token punctuation">.</span>indexOf<span class="token punctuation">(</span>yTempPoint<span class="token punctuation">)</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>visited<span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token operator">//</span>若该点未被处理，则标记已处理
                 visited<span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span>
                 <span class="token keyword">if</span><span class="token punctuation">(</span>cluster<span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> cluster<span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token operator">=</span> number <span class="token operator">//</span>划分到与核心点一样的簇中
                 distanceTemp <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>vectorDis<span class="token punctuation">(</span>x<span class="token punctuation">,</span>yTempPoint<span class="token punctuation">)</span><span class="token punctuation">,</span>data<span class="token punctuation">.</span>indexOf<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">//</span>取得该点到其他所有点的距离Array<span class="token punctuation">{<!-- --></span><span class="token punctuation">(</span>distance<span class="token punctuation">,</span>index<span class="token punctuation">)</span><span class="token punctuation">}</span>
                 neighPointsTemp <span class="token operator">=</span> distanceTemp<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">&gt;</span> x<span class="token punctuation">.</span>_1 <span class="token operator">&lt;=</span> ePs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>v <span class="token operator">=</span><span class="token operator">&gt;</span> data<span class="token punctuation">(</span>v<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">//</span>找到半径ePs内的所有点

                 <span class="token keyword">if</span><span class="token punctuation">(</span>neighPointsTemp<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> minPts<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                   types<span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">//</span>该点为核心点
                   <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span><span class="token operator">-</span> <span class="token number">0</span> to neighPointsTemp<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                     <span class="token operator">//</span>将其领域内未分类的对象划分到簇中<span class="token punctuation">,</span>然后放入neighPoints
                     <span class="token keyword">if</span> <span class="token punctuation">(</span>cluster<span class="token punctuation">(</span>data<span class="token punctuation">.</span>indexOf<span class="token punctuation">(</span>neighPointsTemp<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                       cluster<span class="token punctuation">(</span>data<span class="token punctuation">.</span>indexOf<span class="token punctuation">(</span>neighPointsTemp<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> number <span class="token operator">//</span>只划分簇，没有访问到
                       neighPoints <span class="token operator">+=</span> neighPointsTemp<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
                     <span class="token punctuation">}</span>
                   <span class="token punctuation">}</span>
                 <span class="token punctuation">}</span>
                 <span class="token keyword">if</span><span class="token punctuation">(</span>neighPointsTemp<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> neighPointsTemp<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> minPts<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token operator">//</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>new<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
                   breakable<span class="token punctuation">{<!-- --></span>
                     <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span><span class="token operator">-</span> <span class="token number">0</span> to neighPointsTemp<span class="token punctuation">.</span>length <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token operator">//</span>此为非核心点，若其领域内有核心点，则该点为边界点
                       var index1 <span class="token operator">=</span> data<span class="token punctuation">.</span>indexOf<span class="token punctuation">(</span>neighPointsTemp<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
                       <span class="token keyword">if</span><span class="token punctuation">(</span>types<span class="token punctuation">(</span>index1<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                         types<span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">//</span>边界点<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>new<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
                         <span class="token keyword">break</span>
                       <span class="token punctuation">}</span>
                     <span class="token punctuation">}</span>
                   <span class="token punctuation">}</span>
                 <span class="token punctuation">}</span>
               <span class="token punctuation">}</span>
               neighPoints<span class="token operator">-=</span>yTempPoint <span class="token operator">//</span>将该点剔除
             <span class="token punctuation">}</span><span class="token operator">//</span>end<span class="token operator">-</span><span class="token keyword">while</span>
             number <span class="token operator">+=</span> <span class="token number">1</span> <span class="token operator">//</span>进行新的聚类
           <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">(</span>cluster<span class="token punctuation">,</span>types<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">def</span> <span class="token function">printResult</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span>Array<span class="token punctuation">[</span>Vector<span class="token punctuation">[</span>Double<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>cluster<span class="token punctuation">:</span>Array<span class="token punctuation">[</span>Int<span class="token punctuation">]</span><span class="token punctuation">,</span>types<span class="token punctuation">:</span>Array<span class="token punctuation">[</span>Int<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    val result <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>v <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>cluster<span class="token punctuation">(</span>data<span class="token punctuation">.</span>indexOf<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span>v <span class="token operator">=</span><span class="token operator">&gt;</span> v<span class="token punctuation">.</span>_1<span class="token punctuation">)</span> <span class="token operator">//</span>Map<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span>Array<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span>Vector<span class="token punctuation">[</span>Double<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token operator">//</span>key代表簇号，value代表属于这一簇的元素数组
    result<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>v <span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
      println<span class="token punctuation">(</span><span class="token string">"簇"</span> <span class="token operator">+</span> v<span class="token punctuation">.</span>_1 <span class="token operator">+</span> <span class="token string">"包含的元素如下:"</span><span class="token punctuation">)</span>
      v<span class="token punctuation">.</span>_2<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>v <span class="token operator">=</span><span class="token operator">&gt;</span> println<span class="token punctuation">(</span>v<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token operator">//</span>val noise <span class="token operator">=</span> cluster<span class="token punctuation">.</span><span class="token builtin">zip</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>v <span class="token operator">=</span><span class="token operator">&gt;</span> v<span class="token punctuation">.</span>_1 <span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token operator">//</span>noise<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>v <span class="token operator">=</span><span class="token operator">&gt;</span> types<span class="token punctuation">(</span>data<span class="token punctuation">.</span>indexOf<span class="token punctuation">(</span>v<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">//</span>通过簇号<span class="token number">0</span>把噪音点在types中赋值<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>数据集中没有包含在任何簇中<span class="token punctuation">(</span>即簇号为<span class="token number">0</span><span class="token punctuation">)</span>的数据点就构成异常点
    val pointsTypes <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>v <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>types<span class="token punctuation">(</span>data<span class="token punctuation">.</span>indexOf<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span>v <span class="token operator">=</span><span class="token operator">&gt;</span> v<span class="token punctuation">.</span>_1<span class="token punctuation">)</span> <span class="token operator">//</span>Map<span class="token punctuation">[</span>点类型<span class="token builtin">int</span><span class="token punctuation">,</span>Array<span class="token punctuation">[</span><span class="token punctuation">(</span>点类型<span class="token builtin">int</span><span class="token punctuation">,</span>Vector<span class="token punctuation">[</span>Double<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token operator">//</span>key代表点的类型号，value代表属于这一类型的元素数组
    pointsTypes<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>v <span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>_1 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> println<span class="token punctuation">(</span><span class="token string">"核心点如下："</span><span class="token punctuation">)</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>_1 <span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> println<span class="token punctuation">(</span><span class="token string">"边界点如下："</span><span class="token punctuation">)</span>
      <span class="token keyword">else</span> println<span class="token punctuation">(</span><span class="token string">"噪音点如下："</span><span class="token punctuation">)</span>
      v<span class="token punctuation">.</span>_2<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>v <span class="token operator">=</span><span class="token operator">&gt;</span> println<span class="token punctuation">(</span>v<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    val resultMat <span class="token operator">=</span> cluster<span class="token punctuation">.</span><span class="token builtin">zip</span><span class="token punctuation">(</span>types<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">zip</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">//</span>Array<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Int<span class="token punctuation">,</span>Int<span class="token punctuation">)</span><span class="token punctuation">,</span>Vector<span class="token punctuation">[</span>Double<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>即Array<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span>簇Id，类型Id<span class="token punctuation">)</span><span class="token punctuation">,</span>点向量<span class="token punctuation">)</span><span class="token punctuation">]</span>
    val resultMat1 <span class="token operator">=</span> resultMat<span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span>v <span class="token operator">=</span><span class="token operator">&gt;</span> v<span class="token punctuation">.</span>_1<span class="token punctuation">)</span> <span class="token operator">//</span>Map<span class="token punctuation">[</span><span class="token punctuation">(</span>Int<span class="token punctuation">,</span>Int<span class="token punctuation">)</span><span class="token punctuation">,</span>Array<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Int<span class="token punctuation">,</span>Int<span class="token punctuation">)</span><span class="token punctuation">,</span>Vector<span class="token punctuation">[</span>Double<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    resultMat1<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>v <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
      val arr <span class="token operator">=</span> v<span class="token punctuation">.</span>_2
      <span class="token keyword">if</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>_1<span class="token punctuation">.</span>_2 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        println<span class="token punctuation">(</span><span class="token string">"簇"</span><span class="token operator">+</span>v<span class="token punctuation">.</span>_1<span class="token punctuation">.</span>_1<span class="token operator">+</span><span class="token string">"的核心点集的x坐标为："</span><span class="token punctuation">)</span>
        arr<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>v <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>_2<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        println<span class="token punctuation">(</span><span class="token punctuation">)</span>
        println<span class="token punctuation">(</span><span class="token string">"簇"</span><span class="token operator">+</span>v<span class="token punctuation">.</span>_1<span class="token punctuation">.</span>_1<span class="token operator">+</span><span class="token string">"的核心点集的y坐标为："</span><span class="token punctuation">)</span>
        arr<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>v <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>_2<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        println<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>_1<span class="token punctuation">.</span>_2 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        println<span class="token punctuation">(</span><span class="token string">"簇"</span><span class="token operator">+</span>v<span class="token punctuation">.</span>_1<span class="token punctuation">.</span>_1<span class="token operator">+</span><span class="token string">"的边界点集的x坐标为："</span><span class="token punctuation">)</span>
        arr<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>v <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>_2<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        println<span class="token punctuation">(</span><span class="token punctuation">)</span>
        println<span class="token punctuation">(</span><span class="token string">"簇"</span><span class="token operator">+</span>v<span class="token punctuation">.</span>_1<span class="token punctuation">.</span>_1<span class="token operator">+</span><span class="token string">"的边界点集的y坐标为："</span><span class="token punctuation">)</span>
        arr<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>v <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>_2<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        println<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        println<span class="token punctuation">(</span><span class="token string">"噪音点集的x坐标为："</span><span class="token punctuation">)</span>
        arr<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>v <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>_2<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        println<span class="token punctuation">(</span><span class="token punctuation">)</span>
        println<span class="token punctuation">(</span><span class="token string">"噪音点集的y坐标为："</span><span class="token punctuation">)</span>
        arr<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>v <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>_2<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        println<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">//</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>自定义向量间的运算<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
  <span class="token operator">//</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>向量间的欧式距离<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
  <span class="token keyword">def</span> <span class="token function">vectorDis</span><span class="token punctuation">(</span>v1<span class="token punctuation">:</span> Vector<span class="token punctuation">[</span>Double<span class="token punctuation">]</span><span class="token punctuation">,</span> v2<span class="token punctuation">:</span> Vector<span class="token punctuation">[</span>Double<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>Double <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    var distance <span class="token operator">=</span> <span class="token number">0.0</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span><span class="token operator">-</span> <span class="token number">0</span> to v1<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      distance <span class="token operator">+=</span> <span class="token punctuation">(</span>v1<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">-</span> v2<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>v1<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">-</span> v2<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    distance <span class="token operator">=</span> math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>distance<span class="token punctuation">)</span>
    distance
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<div class="hljs-button signin" data-title="登录后复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4334&quot;}"></div></code>

</body>
</html>
